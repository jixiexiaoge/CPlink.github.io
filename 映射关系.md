# 高德 CAMERA_TYPE → Python nSdiType 映射关系表

## 映射关系总览

| 高德 CAMERA_TYPE | 高德描述 | Python nSdiType | Python描述(中文) | 映射方式 |
|-----------------|---------|----------------|-----------------|---------|
| 0 | 超速拍照 | 1 | 固定测速摄像头 | 🔄 映射 |
| 1 | 道路拍照 | 14 | 治安监控 | 🔄 映射 |
| 2 | 闯红灯拍照 | 6 | 闯红灯拍照 | 🔄 映射 |
| 3 | 违章拍照 | 17 | 违停拍照点 | 🔄 映射 |
| 4 | 公交专用道摄像头 | 9 | 公交专用车道区间 | 🔄 映射 |
| 5 | 应急车道拍照 | 11 | 应急车道拍照 | 🔄 映射 |
| 6 | 测速拍照 | 8 | 测速拍照 | 🔄 映射 |
| 7 | 非机动车道拍照 | 7 | 流动测速摄像头 | ✅ 直接引用 ⚠️ 描述不匹配 |
| 8 | 区间限速启点 | 2 | 区间测速开始 | 🔄 映射 |
| 9 | 区间限速终点 | 3 | 区间测速结束 | 🔄 映射 |
| 10 | 流动测速电子眼 | 7 | 流动测速摄像头 | 🔄 映射 |
| 11 | ECT计费拍照 | 26 | ETC计费拍照 | 🔄 映射 |
| 12 | 人行道拍照 | 41 | 行人乱穿马路多发处 | 🔄 映射 |
| 13 | 礼让行人拍照 | 41 | 行人乱穿马路多发处 | 🔄 映射 |
| 14 | ⚠️ 待确认 | 14 | 治安监控 | ✅ 直接引用 |
| 15 | 超载车辆风险区 | 15 | 超载车辆风险区 | ✅ 直接引用 |
| 16 | 装载不当拍照 | 16 | 装载不当拍照 | ✅ 直接引用 |
| 17 | 违停拍照点 | 17 | 违停拍照点 | ✅ 直接引用 |
| 18 | 未系安全带拍照 | 18 | 单行道 | ✅ 直接引用 ⚠️ 描述不匹配 |
| 19 | 接打手机拍照 | 19 | 铁路道口 | ✅ 直接引用 ⚠️ 描述不匹配 |
| 20 | 学校区域开始 | 20 | 学校区域开始 | ✅ 直接引用 |
| 21 | 学校区域结束 | 21 | 学校区域结束 | ✅ 直接引用 |
| 22 | ⚠️ 待确认 | 22 | 减速带 | ✅ 直接引用 |
| 23 | LPG加气站 | 23 | LPG加气站 | ✅ 直接引用 |
| 24 | 隧道区间 | 24 | 隧道区间 | ✅ 直接引用 |
| 25 | 服务区 | 25 | 服务区 | ✅ 直接引用 |
| 26 | 收费站 | 26 | ETC计费拍照 | ✅ 直接引用 |
| 27 | 多雾路段 | 27 | 多雾路段 | ✅ 直接引用 |
| 28 | 危险品区域 | 28 | 危险品区域 | ✅ 直接引用 |
| 29 | 事故多发路段 | 29 | 事故多发路段 | ✅ 直接引用 |
| 30 | ⚠️ 待确认 | 30 | 急弯路段 | ✅ 直接引用 |
| 31 | 急弯区段1 | 31 | 急弯区段1 | ✅ 直接引用 |
| 32 | 陡坡路段 | 32 | 陡坡路段 | ✅ 直接引用 |
| 33 | 野生动物出没路段 | 33 | 野生动物出没路段 | ✅ 直接引用 |
| 34 | 右侧视野不良点 | 34 | 右侧视野不良点 | ✅ 直接引用 |
| 35 | 视野不良点 | 35 | 视野不良点 | ✅ 直接引用 |
| 36 | 左侧视野不良点 | 36 | 左侧视野不良点 | ✅ 直接引用 |
| 37 | 闯红灯多发 | 37 | 闯红灯多发 | ✅ 直接引用 |
| 38 | 超速多发 | 38 | 超速多发 | ✅ 直接引用 |
| 39 | 交通拥堵区域 | 39 | 交通拥堵区域 | ✅ 直接引用 |
| 40 | 按方向选择车道点 | 40 | 按方向选择车道点 | ✅ 直接引用 |
| 41 | 行人乱穿马路多发处 | 41 | 行人乱穿马路多发处 | ✅ 直接引用 |
| 42 | 应急车道事故多发 | 42 | 应急车道事故多发 | ✅ 直接引用 |
| 43 | 超速事故多发 | 43 | 超速事故多发 | ✅ 直接引用 |
| 44 | 疲劳驾驶事故多发 | 44 | 疲劳驾驶事故多发 | ✅ 直接引用 |
| 45 | 事故多发点 | 45 | 事故多发点 | ✅ 直接引用 |
| 46 | 行人事故多发点 | 46 | 行人事故多发点 | ✅ 直接引用 |
| 47 | 车辆盗窃多发点 | 47 | 车辆盗窃多发点 | ✅ 直接引用 |
| 48 | 落石危险路段 | 48 | 落石危险路段 | ✅ 直接引用 |
| 49 | 路面结冰危险 | 49 | 路面结冰危险 | ✅ 直接引用 |
| 50 | 瓶颈路段 | 50 | 瓶颈路段 | ✅ 直接引用 |
| 51 | 汇入道路 | 51 | 汇入道路 | ✅ 直接引用 |
| 52 | 坠落危险路段 | 52 | 坠落危险路段 | ✅ 直接引用 |
| 53 | 地下车道区间 | 53 | 地下车道区间 | ✅ 直接引用 |
| 54 | 居民区（交通缓和） | 54 | 居民区（交通缓和） | ✅ 直接引用 |
| 55 | 立交 | 55 | 立交 | ✅ 直接引用 |
| 56 | 分岔点 | 56 | 分岔点 | ✅ 直接引用 |
| 57 | 服务区（可加气） | 57 | 服务区（可加气） | ✅ 直接引用 |
| 58 | 桥梁 | 58 | 桥梁 | ✅ 直接引用 |
| 59 | 制动故障事故多发点 | 59 | 制动故障事故多发点 | ✅ 直接引用 |
| 60 | 越线事故多发点 | 60 | 越线事故多发点 | ✅ 直接引用 |
| 61 | 违法通行事故多发点 | 61 | 违法通行事故多发点 | ✅ 直接引用 |
| 62 | 目的地在对面 | 62 | 目的地在对面 | ✅ 直接引用 |
| 63 | 瞌睡停车区 | 63 | 瞌睡停车区 | ✅ 直接引用 |
| 64 | 老旧柴油车管制 | 64 | 老旧柴油车管制 | ✅ 直接引用 |
| 65 | 隧道内变道拍照 | 65 | 隧道内变道拍照 | ✅ 直接引用 |
| else | 其他未知 | 66 | 空/忽略 | 🔄 映射 |

---

## 映射方式说明

### ✅ 直接引用
CAMERA_TYPE 和 nSdiType 值相同，直接传递使用。共 **49** 个类型（7, 14-65，不包括10）。

**注意**：部分直接引用的类型虽然值相同，但高德描述与 Python 描述不完全匹配：
- CAMERA_TYPE=7: 非机动车道拍照 → nSdiType=7: 流动测速摄像头
- CAMERA_TYPE=18: 未系安全带拍照 → nSdiType=18: 单行道
- CAMERA_TYPE=19: 接打手机拍照 → nSdiType=19: 铁路道口

### 🔄 映射
CAMERA_TYPE 和 nSdiType 值不同，需要转换映射。共 **15** 个类型：
- 0 → 1 (超速拍照 → 固定测速摄像头)
- 1 → 14 (道路拍照 → 治安监控)
- 2 → 6 (闯红灯拍照 → 闯红灯拍照)
- 3 → 17 (违章拍照 → 违停拍照点)
- 4 → 9 (公交专用道摄像头 → 公交专用车道区间)
- 5 → 11 (应急车道拍照 → 应急车道拍照)
- 6 → 8 (测速拍照 → 测速拍照)
- 8 → 2 (区间限速启点 → 区间测速开始)
- 9 → 3 (区间限速终点 → 区间测速结束)
- 10 → 7 (流动测速电子眼 → 流动测速摄像头)
- 11 → 26 (ECT计费拍照 → ETC计费拍照)
- 12 → 41 (人行道拍照 → 行人乱穿马路多发处)
- 13 → 41 (礼让行人拍照 → 行人乱穿马路多发处)
- else → 66 (其他未知 → 空/忽略)

### ⚠️ 待确认
CAMERA_TYPE=14, 22, 30 的描述还在确认中。

---

## 缺失映射分析

### 1. 高德 CAMERA_TYPE 待确认描述

| CAMERA_TYPE | 状态 | 说明 |
|------------|------|------|
| **14** | ⚠️ **待确认** | 当前映射到 nSdiType=14 (治安监控)，但高德描述还在确认中 |
| **22** | ⚠️ **待确认** | 当前映射到 nSdiType=22 (减速带)，但高德描述还在确认中 |
| **30** | ⚠️ **待确认** | 当前映射到 nSdiType=30 (急弯路段)，但高德描述还在确认中 |

### 2. Python nSdiType 未被使用的类型

| nSdiType | Python描述(中文) | 状态 | 说明 |
|---------|----------------|------|------|
| **0** | 信号测速/闯灯拍照 | ⚠️ 未使用 | 可能对应 CAMERA_TYPE=2（闯红灯拍照），但当前映射到6 |
| **4** | 区间测速中 | ✅ 特殊处理 | 由 KEY_TYPE:12110 动态设置，不需要 CAMERA_TYPE 映射 |
| **5** | 路口压线摄像头 | ⚠️ 未使用 | 高德可能没有对应的 CAMERA_TYPE |
| **10** | 可变/潮汐车道拍照 | ⚠️ 未使用 | 高德可能没有对应的 CAMERA_TYPE |
| **12** | 禁止加塞 | ⚠️ 未使用 | 高德可能没有对应的 CAMERA_TYPE |
| **13** | 交通信息采集点 | ⚠️ 未使用 | 高德可能没有对应的 CAMERA_TYPE |

---

## 特殊说明

### 区间测速处理逻辑

1. **区间测速开始** (nSdiType=2)
   - 由 KEY_TYPE:10001 处理
   - CAMERA_TYPE=8 → nSdiType=2

2. **区间测速中** (nSdiType=4)
   - 由 KEY_TYPE:12110 处理
   - 当检测到区间测速字段时，动态设置 nSdiType=4
   - **不需要 CAMERA_TYPE 映射**

3. **区间测速结束** (nSdiType=3)
   - 由 KEY_TYPE:10001 处理
   - CAMERA_TYPE=9 → nSdiType=3

---

## 建议修复

### 1. 补充 CAMERA_TYPE=10 的映射 ✅ 已修复

CAMERA_TYPE=10 已确认为"流动测速电子眼"，映射到 nSdiType=7 (流动测速摄像头)。

### 2. 确认 CAMERA_TYPE=14, 22, 30 的描述

需要确认以下 CAMERA_TYPE 的实际描述：
- CAMERA_TYPE=14: 当前映射到 nSdiType=14 (治安监控)
- CAMERA_TYPE=22: 当前映射到 nSdiType=22 (减速带)
- CAMERA_TYPE=30: 当前映射到 nSdiType=30 (急弯路段)

### 3. 考虑 nSdiType=0 的使用

nSdiType=0 表示"信号测速/闯灯拍照"，可能与 CAMERA_TYPE=2（闯红灯拍照）相关。
当前 CAMERA_TYPE=2 映射到 nSdiType=6（闯红灯拍照），可能需要根据实际情况调整。

---

## 映射覆盖率统计

- **已映射的 CAMERA_TYPE**: 66/66 (100%) ✅
- **待确认描述的 CAMERA_TYPE**: 3 个 (14, 22, 30)
- **直接引用的类型**: 49 个 (74.2%)
- **需要映射的类型**: 15 个 (22.7%)
- **未使用的 nSdiType**: 5 个 (0, 5, 10, 12, 13)
  - 注：nSdiType=4 是特殊处理，不算缺失

---

## 代码实现位置

### Android 端
- **文件**: `app/src/main/java/com/example/carrotamap/AmapBroadcastHandlers.kt`
- **函数**: `mapAmapCameraTypeToSdi(cameraType: Int): Int` (第107-176行)
- **文件**: `app/src/main/java/com/example/carrotamap/AmapTrafficHandlers.kt`
- **函数**: `mapAmapCameraTypeToSdi(cameraType: Int): Int` (第24-93行)

### Python 端
- **文件**: `carrot_serv.py`
- **函数**: `_get_sdi_descr(self, nSdiType)` (第400-618行)
- **说明**: 定义了 nSdiType 0-66 的中文、英文、韩文描述

---

# 高德地图 ICON → CarrotMan nTBTTurnType 映射关系表

## 映射关系总览

| 高德 ICON | 高德描述 | nTBTTurnType | Python navType | Python navModifier | Python xTurnInfo | 映射方式 |
|----------|---------|-------------|---------------|-------------------|-----------------|---------|
| 0 | 无转弯/通知指令 | 51 | notification | straight | None | 🔄 映射 |
| 1 | 直行 | 51 | notification | straight | None | 🔄 映射 |
| 2 | 左转 | 12 | turn | left | 1 | 🔄 映射 |
| 3 | 右转 | 13 | turn | right | 2 | 🔄 映射 |
| 4 | 左前方 | 102 | off ramp | slight left | 3 | 🔄 映射 |
| 5 | 右前方 | 101 | off ramp | slight right | 4 | 🔄 映射 |
| 6 | 左后方 | 17 | fork | left | 3 | 🔄 映射 |
| 7 | 右后方 | 19 | turn | sharp right | 2 | 🔄 映射 |
| 8 | 掉头 | 14 | turn | uturn | 7 | 🔄 映射 |
| 9 | 直行 | 51 | notification | straight | None | 🔄 映射 |
| 10 | 到达途经点 | 202 | - | - | - | 🔄 映射（自定义） |
| 11 | 进入环岛（右侧通行） | 131 | rotary | slight right | 5 | 🔄 映射 |
| 12 | 驶出环岛（右侧通行） | 132 | rotary | slight right | 5 | 🔄 映射 |
| 13 | 到达服务区 | 55 | notification | straight | None | 🔄 映射 |
| 14 | 到达收费站 | 206 | - | - | - | 🔄 映射（自定义） |
| 15 | 到达目的地 | 201 | arrive | straight | 8 | 🔄 映射 |
| 16 | 到达/进入隧道 | 207 | - | - | - | 🔄 映射（自定义） |
| 17 | 左侧通行环岛：进入 | 140 | rotary | slight left | 5 | 🔄 映射 |
| 18 | 左侧通行环岛：驶出 | 141 | rotary | slight left | 5 | 🔄 映射 |
| 19 | 右转掉头 | 14 | turn | uturn | 7 | 🔄 映射 |
| 20 | 顺行 | 51 | notification | straight | None | 🔄 映射 |
| 21 | 标准小环岛左转 | 133 | rotary | right | 5 | 🔄 映射 |
| 22 | 标准小环岛右转 | 139 | rotary | left | 5 | 🔄 映射 |
| 23 | 标准小环岛直行 | 142 | rotary | straight | 5 | 🔄 映射 |
| 24 | 标准小环岛调头 | 134 | rotary | sharp right | 5 | 🔄 映射 |
| 25 | 左侧通行小环岛左转 | 133 | rotary | right | 5 | 🔄 映射 |
| 26 | 左侧通行小环岛右转 | 139 | rotary | left | 5 | 🔄 映射 |
| 27 | 左侧通行小环岛直行 | 142 | rotary | straight | 5 | 🔄 映射 |
| 28 | 左侧通行小环岛调头 | 134 | rotary | sharp right | 5 | 🔄 映射 |
| 55 | 行驶到出口 | 55 | notification | straight | None | ✅ 直接引用 |
| 65 | 高架靠左行驶 | 102 | off ramp | slight left | 3 | 🔄 映射 |
| 66 | 高架靠右下匝道 | 101 | off ramp | slight right | 4 | 🔄 映射 |
| 101 | 向右进入辅道 | 1007 | off ramp | right | 4 | 🔄 映射 |
| else | 其他未知 | amapIcon | invalid | "" | -1 | ✅ 直接引用 |

---

## ICON 映射方式说明

### ✅ 直接引用
高德 ICON 和 nTBTTurnType 值相同，直接传递使用：
- **55**: 行驶到出口 → nTBTTurnType=55
- **else**: 其他未知 → 保持原值

### 🔄 映射
高德 ICON 和 nTBTTurnType 值不同，需要转换映射。共 **30+** 个类型。

### 🔄 映射（自定义）
Android 端自定义的 nTBTTurnType，Python 端未定义：
- **202**: 到达途经点（Android 自定义）
- **206**: 到达收费站（Android 自定义）
- **207**: 到达/进入隧道（Android 自定义）

---

## Python 端 nTBTTurnType → navType/navModifier/xTurnInfo 映射

### xTurnInfo 说明
- **1**: left turn (左转)
- **2**: right turn (右转)
- **3**: left lane change (左变道)
- **4**: right lane change (右变道)
- **5**: rotary (环岛)
- **6**: tg (交通灯)
- **7**: arrive or uturn (到达或掉头)
- **8**: arrive (到达目的地)
- **0/None**: notification (通知，无转向)

### 主要映射类型

| nTBTTurnType | navType | navModifier | xTurnInfo | 说明 |
|-------------|---------|------------|----------|------|
| 12 | turn | left | 1 | 左转 |
| 13 | turn | right | 2 | 右转 |
| 14 | turn | uturn | 7 | 掉头 |
| 16 | turn | sharp left | 1 | 急左转 |
| 19 | turn | sharp right | 2 | 急右转 |
| 51-55 | notification | straight | 0/None | 通知/直行 |
| 101 | off ramp | slight right | 4 | 轻微右（匝道） |
| 102 | off ramp | slight left | 3 | 轻微左（匝道） |
| 131-142 | rotary | * | 5 | 环岛相关 |
| 201 | arrive | straight | 8 | 到达目的地 |
| 202 | - | - | - | 到达途经点（自定义） |
| 206 | - | - | - | 到达收费站（自定义） |
| 207 | - | - | - | 到达隧道（自定义） |

---

## 特殊说明

### 1. 环岛处理
- **右侧通行环岛**: ICON 11-12, 21-24 → nTBTTurnType 131-142
- **左侧通行环岛**: ICON 17-18, 25-28 → nTBTTurnType 131-142
- Python 端统一处理为 rotary 类型，xTurnInfo=5

### 2. 自定义类型
Android 端定义了 3 个自定义 nTBTTurnType：
- **202**: 到达途经点
- **206**: 到达收费站
- **207**: 到达/进入隧道

这些类型在 Python 端的 `turn_type_mapping` 中未定义，需要特殊处理。

### 3. 通知类型
多个高德 ICON 映射到 nTBTTurnType=51-55（通知类型）：
- ICON 0, 1, 9, 20 → 51 (通知/直行)
- ICON 13 → 55 (到达服务区)
- ICON 55 → 55 (行驶到出口)

---

## 代码实现位置

### Android 端
- **文件**: `app/src/main/java/com/example/carrotamap/AmapBroadcastHandlers.kt`
- **函数**: `mapAmapIconToCarrotTurn(amapIcon: Int): Int` (第644-693行)
- **说明**: 将高德地图 ICON 映射到 CarrotMan nTBTTurnType

### Python 端
- **文件**: `carrot_serv.py`
- **函数**: `_update_tbt(self)` (第333-399行)
- **变量**: `turn_type_mapping` (第335-383行)
- **变量**: `nav_type_mapping` (第23-77行，全局)
- **说明**: 将 nTBTTurnType 映射到 (navType, navModifier, xTurnInfo)

---

# 高德地图 ROAD_TYPE → CarrotMan roadcate 映射关系表

## 映射关系总览

| 高德 ROAD_TYPE | 高德描述 | CarrotMan roadcate | roadcate描述 | 映射方式 |
|---------------|---------|-------------------|-------------|---------|
| 0 | 高速公路 | 10 | 很宽道路（四车道及以上） | 🔄 映射 |
| 1 | 国道 | 6 | 中等宽度（双车道） | 🔄 映射 |
| 2 | 省道 | 6 | 中等宽度（双车道） | 🔄 映射 |
| 3 | 县道 | 6 | 中等宽度（双车道） | 🔄 映射 |
| 4 | 乡公路 | 6 | 中等宽度（双车道） | 🔄 映射 |
| 5 | 县乡村内部道路 | 6 | 中等宽度（双车道） | 🔄 映射 |
| 6 | 快速道 | 10 | 很宽道路（四车道及以上） | 🔄 映射 |
| 7 | 主要道路 | 6 | 中等宽度（双车道） | 🔄 映射 |
| 8 | 次要道路 | 6 | 中等宽度（双车道） | 🔄 映射 |
| 9 | 普通道路 | 6 | 中等宽度（双车道） | 🔄 映射 |
| 10 | 非导航道路 | 6 | 中等宽度（双车道） | 🔄 映射 |
| else | 未知道路类型 | 6 | 中等宽度（双车道） | 🔄 映射 |

---

## 道路类型映射方式说明

### 🔄 映射规则

**roadcate 含义说明**：
- **roadcate is the width of the road, 10,11 is the highway**
- **10, 11**: 很宽道路（四车道及以上），表示高速公路
- **6**: 中等宽度（双车道），表示非高速公路
- **其他值**: 根据实际道路宽度定义

**映射逻辑**：
1. **高速公路类型** (roadcate=10):
   - ROAD_TYPE=0 (高速公路)
   - ROAD_TYPE=6 (快速道)

2. **非高速公路类型** (roadcate=6):
   - 其他所有 ROAD_TYPE (1, 2, 3, 4, 5, 7, 8, 9, 10, else)

### 特殊处理

**限速修正规则**：
- 当 ROAD_TYPE=0 (高速公路) 或 ROAD_TYPE=6 (快速道)，且 LIMITED_SPEED=40 时
- 强制修正为 55km/h（避免误报的堵车限速）

---

## 代码实现位置

### Android 端
- **文件**: `app/src/main/java/com/example/carrotamap/AmapBroadcastHandlers.kt`
- **函数**: `mapRoadTypeToRoadcate(roadType: Int): Int` (第1225-1235行)
- **函数**: `getRoadTypeDescription(roadType: Int): String` (第1241-1256行)
- **函数**: `getRoadcateDescription(roadcate: Int): String` (第1263-1272行)
- **说明**: 将高德地图 ROAD_TYPE 映射到 CarrotMan roadcate

### Python 端
- **文件**: `carrot_serv.py`
- **变量**: `self.roadcate` (第132行，默认值8)
- **说明**: Python 端接收 roadcate 值，用于判断道路类型（10,11=高速公路）

---

# 高德地图交通红绿灯状态 → CarrotMan traffic_state 映射关系表

## 映射关系总览

| 高德 trafficLightStatus | 高德描述 | CarrotMan traffic_state | CarrotMan描述 | 方向条件 | 映射方式 |
|------------------------|---------|----------------------|-------------|---------|---------|
| -1 | 无效/未知 | -1 | 无效 | - | ✅ 直接引用 |
| 0 | 关闭/无信号 | 0 | off (关闭) | - | ✅ 直接引用 |
| 1 | 红灯 | 1 | red (红灯) | - | ✅ 直接引用 |
| 2 | 绿灯 | 2 或 3 | green (绿灯) 或 left (左转绿灯) | direction=1或3 → 3<br>其他 → 2 | 🔄 条件映射 |
| 3 | 黄灯 | 1 | red (红灯) | - | 🔄 映射 |
| 4 | 绿灯 | 2 | green (绿灯) | - | 🔄 映射 |
| else | 其他未知 | 0 | off (关闭) | - | 🔄 映射 |

---

## 交通红绿灯映射方式说明

### ✅ 直接引用
高德 trafficLightStatus 和 CarrotMan traffic_state 值相同，直接传递使用：
- **-1**: 无效/未知 → traffic_state=-1
- **0**: 关闭/无信号 → traffic_state=0
- **1**: 红灯 → traffic_state=1

### 🔄 条件映射
根据方向信息（direction）进行条件判断：
- **2**: 绿灯
  - 当 direction=1 (左转) 或 direction=3 (左转掉头) 时 → traffic_state=3 (左转绿灯)
  - 其他情况 → traffic_state=2 (绿灯)

### 🔄 映射
高德 trafficLightStatus 和 CarrotMan traffic_state 值不同，需要转换：
- **3**: 黄灯 → traffic_state=1 (红灯，黄灯视为红灯处理)
- **4**: 绿灯 → traffic_state=2 (绿灯)
- **else**: 其他未知 → traffic_state=0 (关闭)

---

## 交通红绿灯方向说明

### 高德 direction 字段含义

| direction | 描述 |
|----------|------|
| 0 | 直行黄灯 |
| 1 | 左转 |
| 2 | 右转 |
| 3 | 左转掉头 |
| 4 | 直行 |
| 5 | 右转掉头 |
| else | 方向$direction |

### CarrotMan traffic_state 说明

| traffic_state | 描述 | 说明 |
|--------------|------|------|
| -1 | 无效 | 无效状态 |
| 0 | off | 关闭/无信号 |
| 1 | red | 红灯 |
| 2 | green | 绿灯 |
| 3 | left | 左转绿灯 |

---

## 特殊处理逻辑

### 1. 状态转换逻辑
当 traffic_state=0 (关闭) 且 leftSec <= 0 时：
- 如果之前的状态是 traffic_state=1 (红灯) 且 leftSec <= 3
- 则自动转换为 traffic_state=2 (绿灯)，leftSec=30
- **目的**: 避免红绿灯信号丢失导致的误判

### 2. 倒计时处理
- **红灯倒计时**: 当 trafficLightStatus=1, 3, 2, 4 时，使用 redLightCountDownSeconds
- **绿灯倒计时**: 使用 greenLightLastSecond

---

## 代码实现位置

### Android 端
- **文件**: `app/src/main/java/com/example/carrotamap/AmapTrafficHandlers.kt`
- **函数**: `mapTrafficLightStatus(amapStatus: Int, direction: Int = 0): Int` (第95-105行)
- **函数**: `handleTrafficLightInfo(intent: Intent)` (第282-338行)
- **函数**: `getTrafficLightDirectionDesc(direction: Int): String` (第107-117行)
- **说明**: 将高德地图交通红绿灯状态映射到 CarrotMan traffic_state

### Python 端
- **文件**: `carrot_serv.py`
- **变量**: `self.traffic_state` (第172行)
- **说明**: Python 端接收 traffic_state 值，用于交通灯状态显示和控制

